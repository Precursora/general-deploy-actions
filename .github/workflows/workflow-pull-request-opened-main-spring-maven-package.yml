name: Validate PR to PROD
on:
  workflow_call:
jobs:
  origin-validation:
    name: Origin validation
    runs-on: ubuntu-latest
    steps:
      - run: echo "⏳ Validando a origem das alterações..."
      - name: Validate
        run: |
          if [[ "${{github.head_ref}}" != "develop" ]]; then
            echo "A origem das alterações deve ser a branch develop";
            exit 1;
          fi
  unit-tests:
    needs: origin-validation
    name: Unit tests
    uses: ./.github/workflows/ext-spring-maven-unit-test.yml
    with:
      minimum-coverage: 60
  mutation-tests:
    needs: origin-validation
    name: Mutation tests
    uses: ./.github/workflows/ext-spring-maven-mutation-test.yml
    with:
      minimum-coverage: 40
  generate-coverage-summary:
    needs:
      - origin-validation
      - unit-tests
      - mutation-tests
    name: Coverage
    uses: ./.github/workflows/ext-tests-generate-coverage-summary.yml
    if: always() && needs.origin-validation.result == 'success'
    with:
      unit-tests-report: ${{needs.unit-tests.outputs.indexes}}
      mutation-tests-report: ${{needs.mutation-tests.outputs.indexes}}
