name: Generate Coverage Summary
on:
  workflow_call:
    inputs:
      unit-tests-report:
        type: string
        required: true
      mutation-tests-report:
        type: string
        required: true
jobs:
  generate-coverage-summary:
    name: Coverage
    runs-on: ubuntu-latest
    steps:
      - name: Coverage
        run: |
          # Check minimum coverage
          unitMinimumCoverage=$(if (( ${{fromJSON(inputs.unit-tests-report).coverage}} < ${{fromJSON(inputs.unit-tests-report).minimum_coverage}} )); then echo "âŒ"; else echo "âœ…"; fi);
          mutationMinimumCoverage=$(if (( ${{fromJSON(inputs.mutation-tests-report).coverage}} < ${{fromJSON(inputs.mutation-tests-report).minimum_coverage}} )); then echo "âŒ"; else echo "âœ…"; fi);
          unitExecutionTime=$(printf "%02s" $((${{fromJSON(inputs.unit-tests-report).execution_time}}/60)))"m "$(printf "%02s" $((${{fromJSON(inputs.unit-tests-report).execution_time}}%60)))"s"
          mutationExecutionTime=$(printf "%02s" $((${{fromJSON(inputs.mutation-tests-report).execution_time}}/60)))"m "$(printf "%02s" $((${{fromJSON(inputs.mutation-tests-report).execution_time}}%60)))"s"
          
          # Summary constrution
          summaryHeader="| Tipo | Cobertura ðŸ§ | Sucesso ðŸ˜Ž | Falha ðŸ¥² | Sem cobertura ðŸ˜¬ | Ignorado ðŸ˜‘ | Tempo de execuÃ§Ã£o ðŸ¥± | Cobertura mÃ­nima atingida ðŸ«£ |"
          summaryAlign="|:--|--|--|--|--|--|--|:--|"
          summaryUnitTests="| UnitÃ¡rio | ${{fromJSON(inputs.unit-tests-report).coverage}}% | ${{fromJSON(inputs.unit-tests-report).success}} | ${{fromJSON(inputs.unit-tests-report).error}} | ${{fromJSON(inputs.unit-tests-report).no_coverage}} | ${{fromJSON(inputs.unit-tests-report).skipped}} | ${unitExecutionTime} | ${{fromJSON(inputs.unit-tests-report).minimum_coverage}}% ${unitMinimumCoverage} |"
          summaryMutationTests="| MutaÃ§Ã£o | ${{fromJSON(inputs.mutation-tests-report).coverage}}% | ${{fromJSON(inputs.mutation-tests-report).success}} | ${{fromJSON(inputs.mutation-tests-report).error}} | ${{fromJSON(inputs.mutation-tests-report).no_coverage}} | ${{fromJSON(inputs.mutation-tests-report).skipped}} | ${mutationExecutionTime} | ${{fromJSON(inputs.mutation-tests-report).minimum_coverage}}% ${mutationMinimumCoverage} |"
          
          # Summary export
          summary="${summaryHeader}\n${summaryAlign}\n${summaryUnitTests}\n${summaryMutationTests}"
          echo -e "${summary}" >> $GITHUB_STEP_SUMMARY
