name: Tests Coverage Validation
on:
  workflow_call:
    inputs:
      unit-tests-report:
        type: string
        required: true
      mutation-tests-report:
        type: string
        required: true
jobs:
  validate-unit-tests:
    name: Validate unit tests
    runs-on: ubuntu-latest
    steps:
      - name: Validate unit tests coverage
        run: |
          if [[ ${{fromJSON(inputs.unit-tests-report).coverage}} < 50.00 ]]; then
            echo "#### â›” Cobertura mÃ­nima de 50% nÃ£o atingida nos testes unitÃ¡rios" >> $GITHUB_STEP_SUMMARY
          else
            echo "#### âœ… Cobertura mÃ­nima de 50% atingida nos testes unitÃ¡rios" >> $GITHUB_STEP_SUMMARY
          fi
  validate-mutation-tests:
    name: Validate mutation tests
    runs-on: ubuntu-latest
    steps:
      - name: Validate mutation tests coverage
        run: |
          if [[ ${{fromJSON(inputs.mutation-tests-report).coverage}} < 50.00 ]]; then
            echo "#### â›” Cobertura mÃ­nima de 50% nÃ£o atingida nos testes de mutaÃ§Ã£o" >> $GITHUB_STEP_SUMMARY
          else
            echo "#### âœ… Cobertura mÃ­nima de 50% atingida nos testes de mutaÃ§Ã£o" >> $GITHUB_STEP_SUMMARY
          fi
  create-summaries:
    name: Create summaries
    runs-on: ubuntu-latest
    steps:
      - name: Summary
        run: |
          summaryHeader="| Tipo | Cobertura ðŸ“Š | Sucesso âœ… | Falha â›” | Ignorado â†©ï¸ | Tempo de execuÃ§Ã£o â³ |"
          summaryAlign="|:--|--|--|--|--|--|"
          summaryUnitTests="| UnitÃ¡rio | ${{fromJSON(inputs.unit-tests-report).coverage}}% | ${{fromJSON(inputs.unit-tests-report).success}} | ${{fromJSON(inputs.unit-tests-report).error}} | ${{fromJSON(inputs.unit-tests-report).skipped}} | ${{fromJSON(inputs.unit-tests-report).execution_time}} |"
          summaryMutationTests="| MutaÃ§Ã£o | ${{fromJSON(inputs.mutation-tests-report).coverage}}% | ${{fromJSON(inputs.mutation-tests-report).success}} | ${{fromJSON(inputs.mutation-tests-report).error}} | ${{fromJSON(inputs.mutation-tests-report).skipped}} | ${{fromJSON(inputs.mutation-tests-report).execution_time}} |"
          summary="${summaryHeader}\n${summaryAlign}\n${summaryUnitTests}\n${summaryMutationTests}"

          echo -e "${summary}" >> $GITHUB_STEP_SUMMARY
